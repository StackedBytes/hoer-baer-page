{% if site.ios_app_id %}

<script>
$(function() {
    var apiURL = "https://itunes.apple.com/lookup?id={{ site.ios_app_id }}&country={{ site.ios_app_country }}&callback=?";

    function prefersApi($element) {
        return String($element.data("preferApi")) === "true";
    }

    function normalized(value) {
        return (value || "").toString().trim();
    }

    function shouldFillText($element) {
        return prefersApi($element) || normalized($element.text()).length === 0;
    }

    function shouldFillAttr($element, attributeName) {
        return prefersApi($element) || normalized($element.attr(attributeName)).length === 0;
    }

    $.getJSON(apiURL)
        .done(function(json) {
            if (!(json.results && json.results.length)) {
                return;
            }

            var appInfo = json.results[0];

            if (appInfo.artworkUrl512) {
                $('link[rel="shortcut icon"]').attr("href", appInfo.artworkUrl512);
            }

            var $pageTitle = $(".pageTitle");
            if (appInfo.trackName && shouldFillText($pageTitle)) {
                $pageTitle.text(appInfo.trackName);
            }

            var $appIconLarge = $(".appIconLarge");
            if (appInfo.artworkUrl512 && shouldFillAttr($appIconLarge, "src")) {
                $appIconLarge.attr("src", appInfo.artworkUrl512);
            }

            var $appIconHeader = $(".headerIcon");
            if (appInfo.artworkUrl512 && shouldFillAttr($appIconHeader, "src")) {
                $appIconHeader.attr("src", appInfo.artworkUrl512);
            }

            var $appName = $(".appName");
            if (appInfo.trackName && shouldFillText($appName)) {
                $appName.text(appInfo.trackName);
            }

            var $headerName = $(".headerName");
            if (appInfo.trackName && shouldFillText($headerName)) {
                $headerName.text(appInfo.trackName);
            }

            var $appPrice = $(".appPrice");
            if (appInfo.formattedPrice && shouldFillText($appPrice)) {
                $appPrice.text(appInfo.formattedPrice);
            }

            var $appStoreLink = $(".appStoreLink");
            if (appInfo.trackViewUrl && shouldFillAttr($appStoreLink, "href")) {
                $appStoreLink.attr("href", appInfo.trackViewUrl);
            }
        })
        .fail(function() {
            // Keep configured fallback values when App Store lookup is unavailable.
        });
});

</script>

{% endif %}
